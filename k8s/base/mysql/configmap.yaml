apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-initdb
  namespace: vvma
  labels:
    app: mysql
    component: database
data:
  init.sql: | 
    -- Create application user with proper permissions
    CREATE USER IF NOT EXISTS 'vvmauser'@'%' IDENTIFIED BY 'Llamasdove404';
    GRANT ALL PRIVILEGES ON user_management.* TO 'vvmauser'@'%';
    FLUSH PRIVILEGES;

    -- Create database
    CREATE DATABASE IF NOT EXISTS user_management;
    USE user_management;

    -- Users table
    CREATE TABLE IF NOT EXISTS users (
      id INT AUTO_INCREMENT PRIMARY KEY,
      username VARCHAR(255) NOT NULL,
      email VARCHAR(255) UNIQUE NOT NULL,
      password VARCHAR(255) NOT NULL,
      role VARCHAR(50) DEFAULT 'user',
      bio TEXT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      INDEX idx_email (email),
      INDEX idx_username (username)
    );

    -- Groups table
    CREATE TABLE IF NOT EXISTS `groups` (
      id INT AUTO_INCREMENT PRIMARY KEY,
      name VARCHAR(255) NOT NULL,
      description TEXT,
      max_members INT NOT NULL,
      invite_code VARCHAR(32),
      creator_id INT NOT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (creator_id) REFERENCES users(id) ON DELETE CASCADE,
      INDEX idx_invite_code (invite_code)
    );

    -- Group members table
    CREATE TABLE IF NOT EXISTS group_members (
      id INT AUTO_INCREMENT PRIMARY KEY,
      group_id INT NOT NULL,
      user_id INT NOT NULL,
      role ENUM('member', 'admin') DEFAULT 'member',
      joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (group_id) REFERENCES `groups`(id) ON DELETE CASCADE,
      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
      UNIQUE KEY unique_group_member (group_id, user_id)
    );

    -- Sample data (users)
    INSERT INTO users (id, username, email, password, role, bio, created_at) VALUES 
    (1,'anna','anna@test.com','anna1@test.com','user',NULL,'2025-02-28 20:51:31'),
    (2,'stella','stella@test.com','password1','user',NULL,'2025-02-28 21:12:52'),
    (3,'Princess','princess@test.com','pppp1234$$','user',NULL,'2025-02-28 21:30:33'),
    (4,'ferdy','ferdy@test.com','ferdy$$','user','Appsec','2025-02-28 21:31:21'),
    (5,'Joy','joya@test.com','idontknow123','admin','Baker','2025-02-28 21:33:52'),
    (6,'Chris','chris@test.com','chriss0000&&','admin','CyberSec','2025-02-28 21:41:19'),
    (7,'Helen','xxxxx@test.com','xxxxx@test.com&&',NULL,NULL,'2025-02-28 21:42:28'),
    (8,'NANA','yasushi@test.com','yasushi@test.com','user','Nana fangirl','2025-02-28 21:43:22'),
    (9,'Jana','jana@example.com','NEWpassword123','user','Student','2025-02-28 21:44:33'),
    (11,'rain','rain@test.com','qwerty','user',NULL,'2025-03-01 13:13:56'),
    (12,'string','string','string','user',NULL,'2025-03-05 09:44:18'),
    (14,'maya','maya@test.com','$$maya1234','user','Photographer','2025-03-05 09:46:17'),
    (15,'jules','jules@test.com','julesPass$$','user',NULL,'2025-03-05 09:50:59'),
    (16,'zephyr','zephyr@example.com','zephyr@example.com01','user',NULL,'2025-03-05 09:51:36'),
    (17,'hackerx','hackerx@test.com','H@ck3rX2024','user','Ethical hacker','2025-03-05 09:52:47'),
    (18,'Yuki','yuki@test.com','yuki$$!123','user','Anime lover','2025-03-05 09:53:55'),
    (19,'alex','alex@test.com','alexPass$$','user','Guitarist','2025-03-05 09:54:52'),
    (20,'ghost','ghost@test.com','Gho$t123$$','admin','Cyber soldier','2025-03-05 09:56:13'),
    (21,'queen','queen@test.com','queenbee','user','Entrepreneur','2025-03-05 09:57:30'),
    (22,'nico','nice@test.com','nicoPass','user','Drummer','2025-03-05 09:58:11'),
    (23,'peachy','peachy@test.com','peachy2000#','user','Skater girl','2025-03-05 10:01:15'),
    (24,'coco','coc@example.com','#coco098##','user',NULL,'2025-03-05 10:15:41'),
    (25,'Anthony','tony@test.com','tonyMontana@','user',NULL,'2025-03-05 10:24:32'),
    (26,'bella','bella@example.com','@bella999$$','user','Tech Enthusiast','2025-03-05 10:25:54'),
    (27,'Shawn','shawnabel@test.com','shawn(#1234)','user',NULL,'2025-03-05 10:27:01'),
    (28,'Jin','jin-bts@test.com','jin123!!!!','user','BTS fan','2025-03-05 10:28:26'),
    (29,'Sammy','abc@example.com','blackMamba$$','user','Nothing here!','2025-03-05 10:29:28'),
    (30,'Dan James','danieljames@test.com','danielpass@@','user','Businessman','2025-03-05 10:30:41'),
    (31,'sunny','sunnyyyy@test.com','sunnyday$$@@','user','Cat Lover','2025-03-05 10:32:37');

    -- Sample data (groups)
    INSERT INTO `groups` (id, name, description, max_members, creator_id, created_at, invite_code) VALUES 
    (1,'my_first_group','this is my first group',11,1,'2025-02-28 21:02:50','9D2A018CFAA405DD'),
    (2,'anime fans','welcome',20,11,'2025-03-01 13:18:50','C917187F8121E3F0'),
    (5,'Cyber Folks','small cybersec study group',10,7,'2025-03-04 07:47:03','A5CA425D5D918750'),
    (6,'Skater Squad','A group for beginner and pro skaters to vibe and share tricks',20,23,'2025-03-05 10:06:44','62895685C6D51734'),
    (7,'Anime Society','Anime lovers discussing latest animes and fan theories',100,18,'2025-03-05 10:09:08','43FBDCE372833497'),
    (8,'Photography','Photography lovers sharing shots and tips on editing',30,14,'2025-03-05 10:10:24','D1D5A1BEBB75D6F6'),
    (9,'Cyber Hunters','For bug bounty hunters',50,20,'2025-03-05 10:11:57','5030E362BACE8FDC'),
    (10,'Code Ninjas','Programmers sharing knowledge on fullstack development',20,6,'2025-03-05 10:14:13','31BCCA485DF5C6BF'),
    (11,'Bookworms','Book readers sharing reviews, book recommendations and book clubs',25,24,'2025-03-05 10:16:55','E776187E3D3C5CF5'),
    (12,'Art & Soul','Artists sharing digital art, sketches, and creative works',55,9,'2025-03-05 10:18:27','3982B8094464D0CC'),
    (13,'Crypto Geeks','Crypto Geeks',7,17,'2025-03-05 10:20:05','0186B64D44F846F2'),
    (14,'Techies','Community of women passionate about tech, innovation, and career growth',200,21,'2025-03-05 10:22:03','960837F47FCBA15D');

    -- Sample data (group members)
    INSERT INTO `group_members` (id, group_id, user_id, role, joined_at) VALUES 
    (1,1,1,'admin','2025-02-28 21:02:50'),(2,1,2,'admin','2025-02-28 21:18:59'),
    (4,2,11,'admin','2025-03-01 13:18:50'),(7,5,7,'admin','2025-03-04 07:47:03'),
    (9,6,23,'admin','2025-03-05 10:06:44'),(10,7,18,'admin','2025-03-05 10:09:08'),
    (11,8,14,'admin','2025-03-05 10:10:24'),(12,9,20,'admin','2025-03-05 10:11:57'),
    (13,10,6,'admin','2025-03-05 10:14:13'),(14,11,24,'admin','2025-03-05 10:16:55'),
    (15,12,9,'admin','2025-03-05 10:18:27'),(16,13,17,'admin','2025-03-05 10:20:05'),
    (17,14,21,'admin','2025-03-05 10:22:03'),(18,5,6,'member','2025-03-05 10:48:05'),
    (19,5,17,'member','2025-03-05 10:48:30'),(20,5,20,'member','2025-03-05 10:48:51'),
    (21,5,31,'member','2025-03-05 10:49:13'),(22,5,29,'member','2025-03-05 10:49:45'),
    (23,5,4,'member','2025-03-05 10:50:10'),(24,6,28,'member','2025-03-05 10:53:25'),
    (25,6,24,'member','2025-03-05 10:53:45'),(26,6,22,'member','2025-03-05 10:54:02'),
    (27,6,19,'member','2025-03-05 10:54:30'),(28,6,1,'member','2025-03-05 10:54:51'),
    (29,6,6,'member','2025-03-05 10:55:07'),(30,6,8,'member','2025-03-05 10:55:22'),
    (31,14,26,'member','2025-03-05 10:56:41'),(32,14,15,'member','2025-03-05 10:57:18'),
    (33,14,14,'member','2025-03-05 10:57:36'),(34,14,12,'member','2025-03-05 10:57:51'),
    (35,14,9,'member','2025-03-05 10:58:10'),(36,14,7,'member','2025-03-05 10:58:24'),
    (37,14,8,'member','2025-03-05 10:58:38'),(38,14,1,'member','2025-03-05 10:59:07'),
    (39,14,2,'member','2025-03-05 10:59:20'),(40,14,5,'member','2025-03-05 10:59:34'),
    (41,14,3,'member','2025-03-05 10:59:49'),(42,14,23,'member','2025-03-05 11:00:35'),
    (43,14,31,'member','2025-03-05 11:00:53'),(44,14,30,'member','2025-03-05 11:02:05'),
    (45,13,30,'member','2025-03-05 11:02:13'),(46,13,25,'member','2025-03-05 11:02:38'),
    (47,13,22,'member','2025-03-05 11:03:03'),(48,13,20,'member','2025-03-05 11:03:19'),
    (49,13,6,'member','2025-03-05 11:03:38'),(50,13,7,'member','2025-03-05 11:03:56'),
    (51,7,1,'member','2025-03-05 11:06:22'),(52,7,8,'member','2025-03-05 11:06:44'),
    (53,7,7,'member','2025-03-05 11:07:02'),(54,7,11,'member','2025-03-05 11:07:23'),
    (55,7,14,'member','2025-03-05 11:07:40'),(56,7,16,'member','2025-03-05 11:07:57'),
    (57,7,24,'member','2025-03-05 11:08:22'),(58,7,28,'member','2025-03-05 11:08:40'),
    (59,7,31,'member','2025-03-05 11:09:00'),(60,7,29,'member','2025-03-05 11:09:18'),
    (61,7,27,'member','2025-03-05 11:09:41'),(62,7,22,'member','2025-03-05 11:10:59'),
    (63,7,3,'member','2025-03-05 11:11:22'),(64,8,9,'member','2025-03-05 11:12:55'),
    (65,8,15,'member','2025-03-05 11:13:09'),(66,8,28,'member','2025-03-05 11:13:41'),
    (67,8,31,'member','2025-03-05 11:14:01'),(68,8,5,'member','2025-03-05 11:15:23'),
    (69,8,8,'member','2025-03-05 11:15:41'),(70,8,12,'member','2025-03-05 11:15:57'),
    (71,12,14,'member','2025-03-05 11:17:00'),(72,12,5,'member','2025-03-05 11:17:18'),
    (73,12,8,'member','2025-03-05 11:17:32'),(74,12,18,'member','2025-03-05 11:21:33'),
    (75,12,23,'member','2025-03-05 11:22:11'),(76,12,19,'member','2025-03-05 11:22:40'),
    (77,1,3,'member','2025-03-05 11:23:17'),(78,9,4,'member','2025-03-05 11:24:40'),
    (79,9,6,'member','2025-03-05 11:24:56'),(80,9,7,'member','2025-03-05 11:25:13'),
    (81,9,17,'member','2025-03-05 11:25:34'),(82,9,29,'member','2025-03-05 11:25:56'),
    (83,9,30,'member','2025-03-05 11:26:14'),(84,10,29,'member','2025-03-05 11:26:55'),
    (85,10,27,'member','2025-03-05 11:27:12'),(86,10,20,'member','2025-03-05 11:27:33'),
    (87,10,17,'member','2025-03-05 11:27:50'),(88,10,16,'member','2025-03-05 11:28:16'),
    (89,10,4,'member','2025-03-05 11:28:41'),(90,10,1,'member','2025-03-05 11:28:54');
